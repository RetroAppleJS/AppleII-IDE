
1. nearest color / dither<br>
2. byte color conflics viewer<br>
3. conflict swapper / image mover left-right (7 bits)<br>


<!doctype html>
<html>
<head>
<title>ditherjs demo</title>
<script src="../res/ditherjs.js"></script>
<style>
body, html {
font-family: 'Arial';
width: 100%;
height: 100%;
margin: 0;
padding: 0;
font-size: 12px;
}
div.wrapper {
/*position: absolute;*/
top: 0px;
left: 0px;
right: 0px;
bottom: 0px;
overflow: hidden;
padding: 5em;
}
div.wrapper > .background {
min-width: 50%;
min-height: 50%;


/*position: absolute;
top: 0px;
left: 0px;
display: block;
z-index: 1;*/
background: #fff;
}
div.headline {
position: relative;
width: 40em;
top: 0;
left: 0;
/*z-index: 9;*/
color: #eee;
text-shadow: 1px 1px #000, 2px 2px #000, 3px 3px #000, 4px 4px #000;
}
.dither {
visibility: hidden;
}
div.headline > .download {
float: left;
width: 25%;
}
div.headline .text {
float: left;
width: 75%;
font-size: 32px;
}
a {
text-decoration: none;
color: inherit;
}
a:hover {
text-shadow: 1px 1px #000;
}
</style>
</head>

<script type="text/javascript" src="../res/EMU_apple2video.js"></script>
<script type="text/javascript" src="../res/EMU_apple2hw.js"></script>
<script type="text/javascript" src="../res/EMU_apple2io.js"></script>

<body onload=update_dither(true)>
<table border=1>
<tr>
    <td class="org"></td>
    <td class="palette"></td>
    <td width=500>
        <div style=float:left;>Step&nbsp;&nbsp;</div>&nbsp;&nbsp;<div id=step_dsp style=float:left;>123 </div><div style=float:left;><input type="range" min="1" max="5" value="3" class="slider" id="step" step=1 style="width:400px;margin-left:5px;" oninput="update_dither()"></div>
        <br><br>
        <div style=float:left;>Ratio&nbsp;&nbsp;</div><div id=ratio_dsp style=float:left;>123 </div><div style=float:left;><input type="range" min="1" max="20" value="4" class="slider" id="ratio" step=1 style="width:400px;margin-left:5px;" oninput="update_dither()"></div>
        <br><br>
        <div>
            <select id="dither_method" onchange=update_dither()>
                <option value="ordered" selected>ordered</option>
                <option value="errorDiffusion">errorDiffusion</option>
              </select>
        </div>
    </td>
</tr>
</table>
<div class="wrapper">
<img class="background dither"src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKUAAADABAMAAACXPL4AAAAAEXRFWHRTb2Z0d2FyZQBKVEwtRGV2J4CxQ84AAAAYUExURfu3KfSEIGe4S+A8QP////3+/ZY/lwSc3JpBtD8AAAABYktHRASPaNlRAAAACXBIWXMAAAsTAAALEwEAmpwYAAACzElEQVR4nO3bUW6jMBAG4FQR741WucBIfm/l9gj7Th0Zn4C9Adrr7y6EMMbGEPzPylXix2B//QcKtDA52N2DVPzzerdJhDYNwU0iuEl4k/Am4U2DNycSZxLeNAIm4U0jYHKSLMQ0AibhTSNg+qRCmEbAJHnTAkwjbyqESXhza+mFmQphkrxpAebm0ssyLcLcHHO3afGmEjAtxDSbY+40Ld5UAqbFmxZvKry5St5vrpN3mxvIJTMMZYLDs3jIomb0V9FfnToFIuaWi2/y3hSa81tupLhwikqa4fwgKq1MmZsxcobS2pSZGSf5ksUZiyYtD5UUOeqblDNU1DQEQbmZSd6q52YuOQZlZnbMMSgz88lr0MkExLwGnUwEOQS9mZCYQ9CbiSH7oKMJitkHHU0q2GS1I0sfTSQJNvl5VB8wg5/vILISMPn1s4bGHMxDuabFmxU3a2xMoFl55qFY0+LNyjPrYk0rbqJLL9q039Ks0bvzwc2vE2DYpylpvgDI16f5kObpaYqakPNd4pp8fmDzVcA8ze7FxZqVgHn2TY0Yb/7fihBTS5g/BcxPzzxCzHcBU3vmBV08zvzg5pcGF//XbDS4+H//v2twUKT5ycwfIPONmUdUUPYM8IIy3wXM6x7tn1nBTD09r8OZHwJmX31vHrFob140FMWb+tybDdTUw3NvCfMXdAxmgyTbb2KO72UKN9vRbMo2p3d8RZvtZDYlm/x9ccFmy80GFlPWtLDShc0GVTrv5UDFlDYbUOlYsw17eCRM9ztzxHqiMsnuf5kOUvqsxwwSE2ku9MI5AdMiSp+bDhATZ3bLfZUSpssvPewpzY8Zmi47ZqSfNjtmxHS5MWO9xLkxY6ZbDuO2xIz2UaeTrMaMmi69yK3EjPd7u/Qau7I53peeXjPb3m3sdU+T3vZuc09+Yom/e7o7+vxdkrz91O7O7w64nd84r/8Aa35WkEZqwpoAAAAASUVORK5CYII=" />
<div>

    
    <canvas class="appvid" id="applescreen" width="560" height="384"></canvas>

<script>
var dither, options;
var loresCols = [];
var HGRpalette;

var vidContext, apple2plus;
function Apple2Plus(context)
{
  this.video = new Apple2Video(context);
  this.hw    = new Apple2Hw(this.video);
  // Switch on Apple II Hi-Res graphics
  this.video.reset();
  this.video.setGfx(true);
  this.video.setHires(true);
  this.video.redraw();
  loresCols = this.video.getloresCols();
  hiresCols = this.video.gethiresCols();

  HGRpalette = [
  HEX2RGB(hiresCols[0][0]),
  HEX2RGB(hiresCols[1][0]),
  HEX2RGB(hiresCols[2][0]),
  HEX2RGB(hiresCols[3][0]),
  HEX2RGB(hiresCols[4][0]),
  HEX2RGB(hiresCols[5][0])
  ];

  function HEX2RGB(hex) {
  var n=parseInt(hex.slice(1),16); return [(n>>16)&0xFF,(n>>8)&0xFF,n&0xFF] }
}

function update_dither(bInit)
{
    vidContext          = document.getElementById('applescreen').getContext("2d");
    apple2plus          = new Apple2Plus(vidContext);
    //alert(loresCols[0][1])

    var step = Number(document.getElementById("step").value);
    document.getElementById("step_dsp").innerHTML = step;
    var ratio = Number(document.getElementById("ratio").value);
    document.getElementById("ratio_dsp").innerHTML = ratio;
    var dither_method = document.getElementById("dither_method").value;

    options = {
                "step": step,
                "className": "dither",
                "palette": HGRpalette,
                "algorithm":dither_method,
                "ratio":ratio
            };

    var el = document.getElementById("ratio");
    switch(dither_method)
    {
        case "ordered": 
            el.setAttribute("min",1);
            el.setAttribute("max",20);
            el.setAttribute("step",1);
            el.value = 1;
        break;
        case "errorDiffusion":
            el.setAttribute("min",1/20);
            el.setAttribute("min",1);
            el.setAttribute("step",(1-(1/20))/20 );
            el.value = 1;
        break;
    }

    if(bInit)
    {
        var el  = document.querySelectorAll(".dither")[0];
        var elw = document.querySelectorAll(".wrapper")[0];
        var elo = document.querySelectorAll(".org")[0];
        var elp = document.querySelectorAll(".palette")[0];

        var src = el.src;
        elo.innerHTML = "<img src='"+src+"'>"

        dither = new DitherJS('.dither',options);

        var paletsize = [50,25];
        var s= "<table>\n";
        for(var i=0;i<HGRpalette.length;i++)
            s+="<tr><td style='border:2px solid;width:"+paletsize[0]+"px;height:"+paletsize[1]+"px;background-color:rgb("+HGRpalette[i].join(",")+")'>&nbsp;</td></tr>\n";
        s+= "</table>\n";
        elp.innerHTML = s;
    }
    else
    {
        //elw.innerHTML = "<img class='background dither' src='"+src+"'>'
        //dither = new DitherJS('.dither',options);        
    }

    //alert(typeof(options.step)+" "+typeof(options.ratio))
    //el[0].src = src;
}


//var coin = Math.random();
//var palette = coin < 0.3 ? HGRpalette : coin < 0.6 ? palette2 : palette3;

/*
var new_el = document.createElement("img");
new_el.setAttribute("src", el[0].src);
var anchor_el = document.getElementById("imgcopy")
anchor_el.appendChild(new_el);
*/

//dither = new DitherJS('.dither',options);
</script>
</body>
</html>
