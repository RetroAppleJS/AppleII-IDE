<!--
//
// Copyright (c) 2024 Freddy Vandriessche.
// notice: https://raw.githubusercontent.com/RetroAppleJS/AppleII-IDE/main/LICENSE.md
//
//   _______                                       _      _____   ______   
//  |_   __ \                                     / |_   |_   _|.' ____ \  
//    | |__) |_ .--.   .--.   _ .--..--.  _ .--. `| |-'    | |  | (___ \_| 
//    |  ___/[ `/'`\]/ .'`\ \[ `.-. .-. |[ '/'`\ \| |  _   | |   _.____`.  
//   _| |_    | |    | \__. | | | | | | | | \__/ || |,| |__' |  | \____) | 
//  |_____|  [___]    '.__.' [___||__||__]| ;.__/ \__/`.____.'   \______.' 
//                                       [__|                              
// PromptJS.js
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT Client (with completion)</title>
</head>

<script type="text/javascript" src="TOOLS_Header.js"></script>
<link rel="stylesheet" href="../res/COM_MAIN.css">

<body onload="init()">


    <div class="slider_main">

        <div class=appbut id=COM_popup style="position: absolute; z-index: 3; left: 0px; top: 120px; " hidden="">
          <div class="appbut" onclick="oCOM.POPUP.toggle('COM_popup');document.getElementById('COM_popup_text').innerHTML=''" style="text-align:center;float:right;">x</div>
          <div id=COM_popup_text></div>
        </div>
      
        <div id="slider_title"></div>
        <div class="slider_overlay">
          <div id="topmenu">
            <ul id="minitabs"> 
              <li id="menu">

                <form id="chatForm">
                    <input type="text" id="query" name="query" style="width:400px" required><input type="submit" value="Send">
                </form>

              </li>
            
            </ul>
          </div>
          <div id="main">

            <div id="response" style="white-space: break-spaces; float:left; border:solid 1px; overflow-wrap:break-word; height:400px; width:245px; overflow-y: scroll; font-size:10px; font-family: 'Courier New', Courier, monospace; vertical-align:top">
            </div>
            
          </div>
        </div>
    </div>
</body>
</html>

Hello! How can I assist you today?

<script>
var CONF_version="1.0.0";
var CONF_builddate="20240617-230000"; 

function init()
{
    if(document.getElementById('slider_title')!=null)
        document.getElementById('slider_title').outerHTML = _TITLE();
}

document.addEventListener('DOMContentLoaded', () => {
    const apiKey = prompt('Please enter your API key:');

    if (!apiKey) {
        alert('API key is required to proceed.');
        return;
    }

    const chatForm = document.getElementById('chatForm');
    const responseDiv = document.getElementById('response');

    chatForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        const query = document.getElementById('query').value;

        //responseDiv.textContent = 'Loading...';

        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', 
            {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [{ role: 'user', content: query }],
                    max_tokens: 100,
                    stream: true
                })
            });

            if (response.ok) {
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                //responseDiv.textContent = ''; // Clear the loading message


                let partialMessage = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value, { stream: true });
                    partialMessage += chunk;

                    // Process each complete JSON object
                    const messages = ('\n\n'+partialMessage).split('\n\ndata: ')
                                    .filter(Boolean); //  remove all empty items from array

                    partialMessage = messages.pop() || '';

                    messages.forEach(message => {
                        try {
                            const json = JSON.parse(message);
                            if (json.choices && json.choices[0].delta && json.choices[0].delta.content)
                            {
                                var content = json.choices[0].delta.content;
                                responseDiv.textContent += content
                            }
                        } catch (e) {
                            console.error('Failed to parse JSON:', e);
                        }
                    });
                }
            } else {
                const errorData = await response.json();
                responseDiv.textContent = `Error: ${errorData.error.message}`;
            }
        } catch (error) {
            responseDiv.textContent = `Error: ${error.message}`;
        }
    });
});



</script>