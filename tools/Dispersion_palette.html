<head>
  <title>Draw Rainbow with Linear gradient</title>
    <style type="text/css">
        body
        {
            font-family: 'Courier';
            font-size: 12px;
        }
        #MyCanvas {
        border:1px solid black;
        }
        #MyCanvas2 {
        border:1px solid black;
        }
        .slider { display: inline-block; }
    </style>
<script type="text/javascript">

/*
    function draw_old() {
        var canvas = document.getElementById("MyCanvas");
        if (canvas.getContext) {
            var ctx = canvas.getContext("2d");
            objGradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            objGradient.addColorStop(0, '#0000FF');
            objGradient.addColorStop(1/6, '#FF00FF');
            objGradient.addColorStop(2/6, '#FF0000');
            objGradient.addColorStop(3/6, '#FFFF00');
            objGradient.addColorStop(4/6, '#00FF00');
            objGradient.addColorStop(5/6, '#00FFFF');
            objGradient.addColorStop(6/6, '#0000FF');
            ctx.fillStyle = objGradient;
            ctx.fillRect(0, 75, canvas.width, 50);
            ctx.fill();
        }
    }
*/

function drawPixel(context, x, y, color)
{
    var roundedX = Math.round(x);
    var roundedY = Math.round(y);

    context.beginPath();
    context.fillStyle = color || '#000';
    context.fillRect(roundedX, roundedY, 1, 1);
    context.fill();
}

var hextab= ['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F']; 
function getHexByte(v) { return hextab[v>>4]+hextab[v&0xf] }
var canvas,ctx;

function init()
{
    canvas = [ document.getElementById("MyCanvas"), document.getElementById("MyCanvas2") ];
    ctx = [ canvas[0].getContext("2d"), canvas[1].getContext("2d") ];
    update_param();
    draw_rainbow();
}

//color_depth2([250,250,250],[24,12]).join(",")

/*
var bits = [24,6]
var p = Math.pow(2, bits[0]/3 );
var q = Math.pow(2, bits[1]/3 );
document.write("p="+p+" q="+q+"<br>")

for(var i=0;i<256;i++)
{
    var c = [i,i,i];
    document.write( c[0] +" "+color_depth2(c,bits)[0]+"<br>" )
}
*/

function color_depth(triple,bits)
{
    p = Math.pow(2, bits[0]/3 );
    q = Math.pow(2, bits[1]/3 );
    var t = [Math.min(255,Math.round( Math.floor(triple[0]/(p/q))*(p-1)/(q-1) ))
            ,Math.min(255,Math.round( Math.floor(triple[1]/(p/q))*(p-1)/(q-1) ))
            ,Math.min(255,Math.round( Math.floor(triple[2]/(p/q))*(p-1)/(q-1) ))]
    return t;
}

function draw_rainbow()
{
    debug_color();

    bUpdate = false;     // allow new updates
    var width  = canvas[1].width;
    var height = canvas[1].height;

    for(var y=0;y<height;y++)
    {
        var j = y;
        for(var x=0;x<width;x++)
        { 
            var i = x;
            var dec_cx = calc_section(i,j,width,height);
            //if(y==150 && x==0) alert(dec_cx.join(",")+" "+color_depth(dec_cx,[24,color_depth_val]).join(",")  );
            //////////////////////////////////////////////////////
            dec_cx = color_depth(dec_cx,[24,color_depth_val]);  // Color depth modifier
            //////////////////////////////////////////////////////
            
            var hex_cx = [getHexByte(dec_cx[0]),getHexByte(dec_cx[1]),getHexByte(dec_cx[2])];
            

            drawPixel(ctx[1], i, j, '#'+hex_cx.join(""));
        }
    }
}

var sec_n  = [7,8];     // sections to show vs sections

function debug_color()
{
    var width  = canvas[0].width;
    var height = canvas[0].height;
    ctx[0].fillStyle = 'white';
    ctx[0].fillRect(0, 0, width, height);
    var pc = "";
    document.getElementById("debug").innerHTML = ""
    for(var i=0;i<=width;i++)
    {
        var v = i*(255/width)
        var dec_cx = [v,v,v];
        var hex_cx = [getHexByte(dec_cx[0]),getHexByte(dec_cx[1]),getHexByte(dec_cx[2])];

        ctx[0].strokeStyle = '#'+hex_cx.join("");
        ctx[0].beginPath();
        ctx[0].moveTo(i, height-50);
        ctx[0].lineTo(i, height-30);
        ctx[0].stroke();

        var dec_dx = color_depth(dec_cx,[24,color_depth_val*3]);
        var hex_dx = [getHexByte(dec_dx[0]),getHexByte(dec_dx[1]),getHexByte(dec_dx[2])];

        ctx[0].strokeStyle = '#'+hex_dx.join("");
        ctx[0].beginPath();
        ctx[0].moveTo(i, height-20);
        ctx[0].lineTo(i, height);
        ctx[0].stroke();
        
        pc = hex_cx.join("");
    }

    var trig = {"x":false,"y":false}
    var s = ["<table border=1 style='text-align:center'>","<tr><td></td>","</tr>","</table>"];
    for(var y=0;y<=height;y+=5)
    {
        s[2]+= "<tr>";
        for(var x=0;x<=width;x+=5)
        {
            var fac_x = x/width;
            var fac_y = y/height;
            var sec   = Math.floor(fac_x*sec_n[0]);
            var sec_x = fac_x*sec_n[0]-sec;
            sec += fac_y>0.5?sec_n[1]:0;
            var dec_y = fac_y*2>1?1:fac_y*2;
            var inc_y = fac_y*2-1;

            if(sec==14)
            {
                // y=0 doesnt work on lower area
                if(!trig.x) trig = {"x":x,"y":y}
                if(y==trig.y) s[1]+="<td style='background-color:#EEEEEE'>"+cap(sec_x)+"</td>";
                if(x==trig.x) s[2]+= "<td style='background-color:#EEEEEE'>dec_y="+cap(dec_y)+" inc_y="+cap(inc_y)+"</td>"
                s[2]+= "<td>"+calc_section(x,y,width,height).join(",")+"</td>";
            }
        }
        s[2]+= "</tr>"
    }
    document.getElementById("debug").innerHTML = s.join("");
}

function cap(v) { return Math.floor(v*100)/100 }

var toRad = function(angle) { return angle * (Math.PI / 180) }
var sx = 0;
function calc_section(x,y,width,height)
{
    var fac_x = x/width;
    var fac_y = y/height;

    var sec   = Math.floor(fac_x*sec_n[0]);
    var sec_x = fac_x*sec_n[0]-sec;
    sec += fac_y>0.5?sec_n[1]:0;

    drawPixel(ctx[0], x,sec_x*(width/sec_n[0]), 'black');

    ////////////////////////////////////////////////////////////////
    //if(sec & 1) sec_x += 0.22*Math.sin(toRad(180+180*sec_x));     //  Bend x
    //else        sec_x += 0.22*Math.sin(toRad(180*sec_x));         //
    ////////////////////////////////////////////////////////////////


    drawPixel(ctx[0], x,sec_x*(width/sec_n[0]), 'black');

    var dec_y = fac_y*2>1?1:fac_y*2;
    var inc_y = fac_y*2-1;
    return section(sec,sec_x,inc_y,dec_y);
}

function section(sec,sec_x,inc_y,dec_y)
{
    function r(v) { return Math.floor(v) }
    var drk = {"up":r(sec_x*255*dec_y),"dn":r(255*(1-sec_x)*dec_y),"max":255*dec_y,"min":0
    ,"uh0":r(sec_x*128*dec_y)
    ,"uh1":r(128+sec_x*128*dec_y)
    ,"dh0":r((128-sec_x*128)*dec_y)
    ,"dh1":r((251-sec_x*128)*dec_y)
    }
    var lgt = {"up":r(drk.up+(255-drk.up)*inc_y),"dn":r(drk.dn+(255-drk.dn)*inc_y),"max":r(drk.max+(255-drk.max)*inc_y),"min":r(drk.min+(255-drk.min)*inc_y)
    ,"uh0":r(drk.uh0)
    ,"dh1":r(drk.dh1)
    }
    //if(sec==6 && x==sx) document.write(drk.dh+"&nbsp;&nbsp;&nbsp;"+dec_y+" "+sec_x+"<br>");
    //if(sec==6 && sx==0) sx = x;
    //if(x==sx && sec==6) document.write("y="+y+" "+[drk.uh,drk.uh,drk.dh].join(",")+"<br>");
    
    switch(sec)
    {
        case 0: return [drk.up,drk.min,drk.max];
        case 1: return [drk.max,drk.min,drk.dn];
        case 2: return [drk.max,drk.up,drk.min];
        case 3: return [drk.dn,drk.max,drk.min];
        case 4: return [drk.min,drk.max,drk.up];
        case 5: return [drk.min,drk.dn,drk.max];
        case 6: return [drk.uh0,drk.uh0,drk.dh1];
        case 7: return [drk.dh0,drk.dh0,drk.uh1];

        case 8: return [lgt.up,lgt.min,lgt.max];
        case 9: return [lgt.max,lgt.min,lgt.dn];
        case 10: return [lgt.max,lgt.up,lgt.min];
        case 11: return [lgt.dn,lgt.max,lgt.min];
        case 12: return [lgt.min,lgt.max,lgt.up];
        case 13: return [lgt.min,lgt.dn,lgt.max];
        case 14: return [lgt.uh0,lgt.uh0,lgt.dh1];
        case 15: return [lgt.dn,lgt.dn,lgt.max];
        default: return [255,255,255]
    }
}

var bUpdate = false;
var color_depth_val = 24; 
function update_param()
{
  if(bUpdate==false) setTimeout(draw_rainbow, 1000);
  bUpdate          = true;
  color_depth_val  = Number(document.getElementById("param1").value);
  //draw_rainbow();
  document.getElementById("disp_param1").innerHTML 
      = color_depth_val 
      + "bits ("+Math.pow(2,color_depth_val)+"&nbsp;cols) "
      +Math.round( Math.pow(2, color_depth_val/3 )*100)/100+"&nbsp;RGBcols";
}


</script>
</head>
<body onload="init()">
  <canvas id="MyCanvas" width="550" height="200">
  This browser or document mode doesn't support canvas object</canvas>
<br>
<div style="">
<div id=disp_param1 class="slider" style="width:100px"></div><input type="range" min="1" max="24" value="8" class="slider" id="param1" step=1 style="width:300px;height:20px;margin-top:10px;" oninput="update_param()">
</div>
<br>
  <canvas id="MyCanvas2" width="550" height="200">
    This browser or document mode doesn't support canvas object</canvas>
<div id=debug></div>
</body>
</html>