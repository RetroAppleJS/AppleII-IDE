<html style="background-color:#B0B0B0"><head>
  <title>HGR PATTERN GENERATOR</title>
  <meta name="description" content="">
  <meta name="author" content="Freddy Vandriessche">
  <meta charset="utf-8">
  <style>
  html {height:100%;font-family:"Arial"}
  body {background-color:#808080;height:100%;margin:0px;padding:0px}
  .tcell10 {width:10px;height:10px;background-color:white;padding:0;border:1px solid white}
  .tcell5 {width:5px;background-color:red;padding:0;border:1px solid white}
  </style>
</head>

<script type="text/javascript" src="../res/EMU_apple2video.js"></script>
<script type="text/javascript" src="../res/EMU_apple2hw.js"></script>
<script type="text/javascript" src="../res/EMU_apple2io.js"></script>

<script>

/////////////////////////////////////////////////////////
// INITIALISE DATA

var CONF_version="";
var CONF_builddate="";  

var _D = 
{
     "cam_x":256
    ,"cam_y":192
    ,"YVERTL":"0000000000000000"+"8080808080808080"+"0000000000000000"+"8080808080808080"+"0000000000000000"+"8080808080808080"+"0000000000000000"+"8080808080808080"
              +"2828282828282828"+"A8A8A8A8A8A8A8A8"+"2828282828282828"+"A8A8A8A8A8A8A8A8"+"2828282828282828"+"A8A8A8A8A8A8A8A8"+"2828282828282828"+"A8A8A8A8A8A8A8A8"
              +"5050505050505050"+"D0D0D0D0D0D0D0D0"+"5050505050505050"+"D0D0D0D0D0D0D0D0"+"5050505050505050"+"D0D0D0D0D0D0D0D0"+"5050505050505050"+"D0D0D0D0D0D0D0D0"
    ,"YVERTH":"2024282C3034383C"+"2024282C3034383C"+"2125292D3135393D"+"2125292D3135393D"+"22262A2E32363A3E"+"22262A2E32363A3E"+"23272B2F33373B3F"+"23272B2F33373B3F"
              +"2024282C3034383C"+"2024282C3034383C"+"2125292D3135393D"+"2125292D3135393D"+"22262A2E32363A3E"+"22262A2E32363A3E"+"23272B2F33373B3F"+"23272B2F33373B3F"
              +"2024282C3034383C"+"2024282C3034383C"+"2125292D3135393D"+"2125292D3135393D"+"22262A2E32363A3E"+"22262A2E32363A3E"+"23272B2F33373B3F"+"23272B2F33373B3F"
}
var yref = new Array();
  for(var i=0;i<_D.YVERTL.length;i+=2)
    yref[i/2] = parseInt( _D.YVERTH.substring(i,i+2),16)*256
               +parseInt( _D.YVERTL.substring(i,i+2),16);

// Monochrome colors (index 0 = full color)
var monoChromes = ["","#FFFFFF","#A0FFF0","#FCE7A1"];

// Lores color to RGB table. (* Hires)
var loresCols = [
["#000000","#000000","#000000","#000000","Black"]  // *
,["#901740","#4D4D4D","#304D48","#4C4631","Magenta"] 
,["#402CA5","#5B5B5B","#395B56","#5A5239","Dark Blue"] 
,["#D043E5","#A8A8A8","#69A89E","#A6986A","Purple"]  // *
,["#006940","#383838","#233835","#383324","Dark Green"] 
,["#808080","#808080","#508078","#7E7451","Grey 1"] 
,["#2F95E5","#8E8E8E","#598E85","#8C8059","Medium Blue"]  // *
,["#BFABFF","#CECECE","#81CEC2","#CBBA82","Light Blue"] 
,["#405400","#313131","#1F312E","#312D1F","Brown"] 
,["#D06A1A","#717171","#47716B","#706748","Orange"]  // *
,["#808080","#808080","#508078","#7E7451","Grey 2"] 
,["#FF96BF","#C7C7C7","#7DC7BB","#C4B47D","Pink"] 
,["#2FBC1A","#575757","#375752","#564F37","Light Green"]  // *
,["#BFD35A","#A4A4A4","#67A49A","#A29568","Yellow"] 
,["#6FE8BF","#B2B2B2","#70B2A8","#B0A170","Aquamarine"] 
,["#FFFFFF","#FFFFFF","#A0FFF0","#FCE7A1","White"]  // *
];

/////////////////////////////////////////////////////////
// ONLOAD

function init_gui(_o)
{
  document.getElementById('slider_title').outerHTML = _TITLE();
  vidContext          = document.getElementById('applescreen').getContext("2d");
  apple2plus          = new Apple2Plus(vidContext);
  wipe_HGR(0);
  show_BITMAPS();
  wipe_HGR(0);
}

/////////////////////////////////////////////////////////
// CALL FUNCTIONS

var vidContext, apple2plus;
function Apple2Plus(context)
{
  this.video = new Apple2Video(context);
  this.hw    = new Apple2Hw(this.video);
  // Switch on Apple II Hi-Res graphics
  this.video.reset();
  this.video.setGfx(true);
  this.video.setHires(true);
  this.video.redraw();
}

function pattern(idx,j,i)
  {
    // output = [color_index, pixel_decision, high_bit ]
    switch(idx)
    {
      case 0:  return  [0 ,false,0];                 // black 1 
      case 1:  return  [4 ,(j+1)%2==0,0];            // green 
      case 2:  return  [3 ,j%2==0,0];                // purple
      case 3:  return  [15,true,0];                  // white 1  
      case 4:  return  [0 ,false,128];               // black 2
      case 5:  return  [9 ,(j+1)%2==0,128];          // orange
      case 6:  return  [2 ,j%2==0,128];              // blue
      case 7:  return  [15,true,128];                // white2 2

      case 10:  return  [4 ,(j+1)%2==0 && i%2==0,0];  // dark green 
      case 11:  return  [3 ,j%2==0 && i%2==0,0];      // dark purple       
      case 12: return  [9 ,(j+1)%2==0 && i%2==0,128];// dark orange
      case 13: return  [2 ,j%2==0 && i%2==0,128];    // dark blue
      case 14: return  [4 ,(j+1)%2==0 || i%2==0,0];  // dark green 
      case 15: return  [3 ,j%2==0 || i%2==0,0];      // dark purple    
      case 16: return  [9 ,(j+1)%2==0 || i%2==0,128];// dark orange
      case 17: return  [2 ,j%2==0 || i%2==0,128];    // dark blue
      case 18: return  [15 ,i%2==0,0];

      case 20: return  [4 ,(j+1)%2==0 && i%2==0 || j%2==0 && i%2!=0,0];
      case 21: return  [4 ,(j+1)%2==0,i%2!=0?128:0];
      case 22: return  [4 ,(j+1)%2==0 && i%2==0 || j%2==0 && i%2!=0,i%2!=0?128:0];
      case 23: return  [4 ,j%2==0 && i%2==0 || (j+1)%2==0 && i%2!=0,i%2!=0?128:0];
      case 24: return  [4 ,j%2==0,i%2!=0?128:0];
      case 25: return  [4 ,(j+1)%2==0 && i%2==0 || j%2==0 && i%2!=0,128];  

      case 30: return  [15 ,i%2==0 && ( (j>>1)%2!=0 || (j+1)%2==0) || i%2!=0 && (j+1)%2!=0,0]; 
      case 31: return  [15 ,i%2==0 && ( (j>>1)%2!=0 || (j+1)%2==0) || i%2!=0 && j%2!=0,i%2!=0?128:0];   
      case 32: return  [15 ,i%2==0 && ( (j>>1)%2!=0 || (j+1)%2==0) || i%2!=0 && (j+1)%2!=0,i%2!=0?128:0]; 
      case 33: return  [15 ,i%2==0 && ( (j>>1)%2!=0 || (j)%2==0)   || i%2!=0 && j%2!=0,i%2!=0?128:0];  
      case 34: return  [15 ,i%2==0 && ( (j>>1)%2!=0 || (j)%2==0)   || i%2!=0 && (j+1)%2!=0,i%2!=0?128:0]; 
      case 35: return  [15 ,i%2==0 && ( (j>>1)%2!=0 || (j+1)%2==0) || i%2!=0 && (j+1)%2!=0,128];  
      case 36: return  [15 ,i%2==0 && ( (j>>1)%2!=0 || (j+1)%2==0) || i%2!=0 && j%2!=0,i%2==0?128:0];
      case 37: return  [15 ,i%2==0 && (j>>1)%2!=0 || i%2!=0,0];
      case 39: return  pat(idx,j,i);
      default: return [0,false,0];  
    }

    function pat(idx,j,i)
    {
      var a = new Array();
      a[0] = 0;
      var ba = [("01110111").split("").reverse().join("")
               ,("10101010").split("").reverse().join("")];
      a[1] = ba[i%2].charAt(j%8)=="1";
      a[2] = ba[i%2].charAt(0)=="1"?128:0;

      //return  [a , b, c];
      //var t = [0 ,i%2==0 && ( (j>>1)%2!=0 || (j+1)%2==0) || i%2!=0 && j%2!=0,i%2==0?128:0];
      return a;
    }
  }

function setPixel_HGR(x,y,patternID)
{
    // find address and bit location
    var adr = yref[y] + Math.floor(x/7);              // find address 
    var rbyt = apple2plus.hw.read(adr);
    //rbyt = rbyt & ~(1 << x%7) & 127; 
    var wbyt = rbyt | (1 << x%7);    // OR current bit with pixel bit
    if(rbyt ==0 && rbyt&8 != pattern(patternID,x,y)[2])
      wbyt |= pattern(patternID,x,y)[2];              // OR high bit
    else
    {
      wbyt |= pattern(patternID,x,y)[2];
      //document.getElementById("debug").innerHTML += "CONFLICT "+PRINTByte(rbyt)+" >> "+PRINTByte(wbyt)
    }  // Hi-Byte conflict !!

    if(pattern(patternID,x,y)[1])
        apple2plus.hw.write(adr,wbyt);                    // write byte 
}

function clearPixel_HGR(x,y)
{
    // find address and bit location
    var adr = yref[y] + Math.floor(x/7);              // find address 
    var rbyt = apple2plus.hw.read(adr);

    //rbyt = rbyt & ~(1 << x%7);
    var wbyt = rbyt & ~(1 << x%7) & 127;   // OR current bit with pixel bit
    apple2plus.hw.write(adr,wbyt);                    // write byte 
}

function getPixel_HGR(x,y)
{
    // find address and bit location
    var adr = yref[y] + Math.floor(x/7);              // find address 
    var rbyt = apple2plus.hw.read(adr);
    var bit = (rbyt >> (x%7)) & 1 == 1;
    var hbit  = rbyt & 128;
    return [ bit,hbit ]
}

function wipe_HGR(byte)
{
    // find address and bit location
    //var adr = yref[y] + Math.floor(x/7);              // find address 
    //var wbyt = apple2plus.hw.read(adr) | 1 << x%7;    // OR current bit with pixel bit
    for(var adr=8192;adr<16384;adr++)
    apple2plus.hw.write(adr,byte);                    // write byte 
}

function PRINTByte(by)
{
var sa = ("0000000"+by.toString(2)).slice(-8).split("");
//sa = sa.reverse();
var styl = " style='padding:5px;border:1px solid;font-family:Arial'"
return "<table style='border-collapse: collapse;'><tr><td"+styl+">"+sa.join("</td><td"+styl+">")+"</td></tr></table>"
}

function show_BITMAPS()
{
  //for(var i=8192;i<16384;i++)      // clear video RAM
  //  apple2plus.hw.write(i,0);

  var s = "<big><font color=white>BITMAPS<font></big><br><br>";
  for(var p=0;p<32;p++)
  {
    s+= "<font color=white>"+p+"</font><br>";
    s+= "<table class=tcell style='margin:0;padding:0;border:1px solid black;'>";
    for(var y=0;y<24;y++)
    {
      s+="<tr>"
        for(var x=0;x<21;x++)
          s+= gen_cell(p,x,y);
      s+="</tr>";
    }
    s+="</table><br>";
  }  
  document.getElementById("debug").innerHTML += s;
}

function gen_cell(p,x,y)
{
  var px1 = "<img src=\"../res/pixT.gif\" style=\"width:9px;height:9px\">";
  var px2 = "<img src=\"../res/pixT.gif\" style=\"width:4px;height:9px\">";
  //var px2 = "<img src=\"data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\" style=\"width:4px;height:9px\">";
var px1 = px2 = "";
  var c = pattern(p,x,y);
  var bi = isNaN(p); 
  var pix = c[1]?"background-color:black":"";
  var bck = (c[2]==128?"border-color:#FFE9D0":"");
  var s= "<td class=tcell10 style=\""+pix+";padding:0;"+bck+"\">"
            +px1
            +"</td>"
  if((x+1)%7==0)
    s+= "<td class=tcell5>"
                +px2
                +"</td>"
  return s;
}

/*
function show_BITMAPS2()
{
  var bls = [24,24];
  var s = "<big><font color=white>BITMAPS<font></big><br><br>";
  for(var p=0;p<32;p++)
  {
    //wipe_HGR(0);
    for(var y=0;y<bls[1];y++)
        for(var x=0;x<bls[0];x++)
        {
            clearPixel_HGR(x,y);
            setPixel_HGR(x,y,p);
        }
    
    s+= "<font color=white>"+p%8+"</font><br>"
    s+= "<table style='margin:0;padding:0;border:1px solid black;'>"
    for(var y=0;y<bls[1];y++)
    {
        s+="<tr>"
        for(var x=0;x<bls[0];x++)
        {
            var a = getPixel_HGR(x,y);
            var pix = a[0]?"background-color:#000000":"background-color:#FFFFFF";
            s+= "<td style=\""+pix+";width:10;height:10;margin:0;padding:0;border:1px solid white;border-collapse:collapse;\"></td>";
            if((x+1)%7==0) 
            {
              var pix = a[1]?"background-color:#000000":"background-color:#FFFFFF";
              s+= "<td style=\""+pix+";width:10;height:10;margin:0;padding:0;border:1px solid red;border-collapse:collapse;\"></td>";
            }
        }
        s+="</tr>"
    }
  }
  document.getElementById("debug").innerHTML += s;
}
*/

function generate_HGR()
{ 
    wipe_HGR(0);
    var pid = 0;
    var bls = [17,17];
    var spc = [10,10]
    for(var dy=0;dy<4;dy++)
    {
            for(var dx=0;dx<10;dx++)
            {
                // DRAW LINE SQUARE
                for(var x=-3;x<bls[0]+3;x++)
                {
                  setPixel_HGR(x+spc[0]+dx*(bls[0]+spc[0]),-4+spc[1]+dy*(bls[1]+spc[1]),3);
                  setPixel_HGR(x+spc[0]+dx*(bls[0]+spc[0]),-3+spc[1]+dy*(bls[1]+spc[1]),3);
                  setPixel_HGR(x+spc[0]+dx*(bls[0]+spc[0]),bls[1]+2+spc[1]+dy*(bls[1]+spc[1]),3);
                  setPixel_HGR(x+spc[0]+dx*(bls[0]+spc[0]),bls[1]+3+spc[1]+dy*(bls[1]+spc[1]),3);
                }
                for(var y=-3;y<bls[1]+3;y++)
                {
                  setPixel_HGR(-4+spc[0]+dx*(bls[0]+spc[0]),y+spc[1]+dy*(bls[1]+spc[1]),3);
                  setPixel_HGR(-3+spc[0]+dx*(bls[0]+spc[0]),y+spc[1]+dy*(bls[1]+spc[1]),3);
                  setPixel_HGR(bls[0]+2+spc[0]+dx*(bls[0]+spc[0]),y+spc[1]+dy*(bls[1]+spc[1]),3);
                  setPixel_HGR(bls[0]+3+spc[0]+dx*(bls[0]+spc[0]),y+spc[1]+dy*(bls[1]+spc[1]),3);
                }          

                // DRAW SOLID SQUARE
                for(var y=0;y<bls[1];y++)
                    for(var x=0;x<bls[0];x++)
                        setPixel_HGR(x+spc[0]+dx*(bls[0]+spc[0]),y+spc[1]+dy*(bls[1]+spc[1]),pid);
                pid++;
            }
    }  
    
}



/////////////////////////////////////////////////////////
// GUI TEMPLATE

var _T = function _T(idx,mod) {
this.t = {get _language(){ return "NL" }
,"title":document.title
,"menu_convert":""
,"menu_info":"Info/Contact"
,"intro":""
,"version":(CONF_version?("Version "+CONF_version):"")
,"built":(CONF_builddate?("Built "+CONF_builddate):"")
,get _(){return this}
}
if(idx.length>0 && typeof(this.t[idx])=="undefined") { alert(idx); return "<font color=red>"+idx+"</font>" }
switch(mod) {
  case "cap": return this.t[idx].charAt(0).toUpperCase()+this.t[idx].substring(1,this.t[idx].length);
  case "inv": { var j = {}; for(var i in t) { j[ t[i] ] = i }; return j } // inverse associative
  default: return this.t[idx];
}
}
function _D(idx) { if(typeof(_T(idx)=="string")) document.write(_T(idx)) }
function _TITLE() {
var css = "#texturespace {background: #f7f7f7 url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAEEAYAAAD5YUI9AAAACXBIWXMAAA4mAAAOJgGi7yX8AAAARElEQVQIHWPYyrxTed9eg3UQWkQHQgtaQGg5JgaohAdUoglC8z+A0mFQBYIpUIEXULoOQgvIQRXIBUElMqASShBaWQwApNg4NPAzQGwAAAAASUVORK5CYII=') repeat center top;font: 62.5%/1 sans-serif;height: 100%;width: 100%;}"
+"#carvetext {color: transparent;background: #f7f7f7;font: 62.5%/1 sans-serif;stroke: 2px rgba(0,0,0,0.2);background-color: rgba(140,140,140,1);-webkit-background-clip: text;text-shadow: rgba(255,255,255,0.5) 0 5px 6px, rgba(255,255,255,0.2) 1px 3px 3px;transition: text-shadow .1s ease-out, background-color .2s ease-out;}"
+"#carvetext:hover {color: transparent;background-color: rgba(82,96,117,0.5);-webkit-background-clip: text;text-shadow: rgba(255,255,255,0.5) 0 5px 6px;}"
+"#carvetext:focus {outline: none;}.slider_main {position: relative;height: 100%;}"
+".slider_overlay {position: absolute;bottom: 0;left: 0;right: 0;background-color: #A0A0A0;overflow: hidden;width: 100%;height: 85%;transition: .5s ease;}"
//+".slider_main:hover "
+".slider_overlay {height: 100%;}"
+"#topmenu{width:100%;background-color:#f0f0f0}"
+"ul#minitabs{list-style:none;margin:0;padding:3px 0 0 0;border-left:1px solid #ccc;border-right:1px solid #ccc;border-top:1px solid #ccc;border-bottom:1px solid #ccc;font-weight:700;text-align:left;white-space:nowrap}ul#minitabs li{display:inline;margin:0 3px}ul#minitabs a{text-decoration:none;color:#999}ul#minitabs a#current{border-color:#f60;color:#06f}ul#minitabs a:hover{border-color:#f60;color:#666}"

return "<style>"+css+".slider_overlay{height: 85%}</style>"
+"<div id=texturespace style='height:100%;width:100%'><center><div id='carvetext'>"
+"<div style='font-size:5em'>"+(typeof(_T("title"))=="string"?_T("title"):"")+"</div>"
+"<div style='font-size:1em'>"+(typeof(_T("version"))=="string"?_T("version"):"")
+" &nbsp; "+(typeof(_T("built"))=="string"?_T("built"):"")+"</div>"
+"</div></center></div>"
}


</script>

 <body class="slider_main" onload=init_gui()>

<div id="slider_title"></div>
 <div class="slider_overlay">
    <div id="topmenu">
      <ul id="minitabs">
        <li><input type=button value="Generate_HGR" onclick="generate_HGR()" style='vertical-align:top; margin:4px 0px 0px 0px'></li>
        <li><img src='data:image/gif;base64,R0lGODlhGAAYAPAAAF3/AAAAACH5BAEAAAAALAAAAAAYABgAAAJPhG+hiu0Y4JsnSvqsBRvXtHXVQmpM4ogN+V1T2aJcSZ9cW+c4mNOf2fOBeEHWcFZc/IjFHbIpu1FgUelLWX1SsVaPKeaRhsKubLijOhspBQA7'></li>
      </ul>
    </div>
    <div id=main>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.24/webcam.js"></script>

<!-- -->
<table><tr>
  <td style=vertical-align:top;><div id="results"></div>
    <div id=debug style="overflow:scroll; height:400px;"></div></td>
  <td style=vertical-align:top;><canvas class="appvid" id="applescreen" width="560" height="384"></canvas></td>
</tr></table>

  </div>
  </div>
</body>
</html>