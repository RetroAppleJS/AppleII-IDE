<html style="background-color:#B0B0B0"><head>
  <title>APPLE II DISK TOOL - convert .dsk to .nib</title>
  <meta name="description" content="">
  <meta name="author" content="Freddy Vandriessche">
  <meta charset="utf-8"> 
</head>

<script type="text/javascript" src="TOOLS_Header.js"></script>
<script type="text/javascript" src="../res/COM_MAIN.js"></script>
<script type="text/javascript" src="../res/EMU_apple2main.js"></script>

<script>
function init_gui(_o) { document.getElementById('slider_title').outerHTML = _TITLE(); }
var CONF_version="1.0.0"
var CONF_builddate="20231224-140000" 

var dsk_bytes = new Array();
var nib_dsk_bytes = new Array();

function dl()
{
  nib_dsk_bytes = apple2ConvertDskToNib(oCOM.UploadData);
  var fileName = oCOM.UploadName.replace(".DSK",".NIB").replace(".dsk",".nib"); 
  oCOM.Download(fileName,nib_dsk_bytes)
}

function dumpdisk(bytes)
{
    var s_arr = [];
    var TRACK_SIZE =    6656;
    for(var _t=0;_t<35;_t++)  // ITERATE THROUGH TRACKS
    {
        s_arr[s_arr.length] = "track $"+oCOM.getHexByte(_t);
        var SECTOR_SIZE = TRACK_SIZE / 16;
        for(var _s=0;_s<16;_s++)
        {
            s_arr[s_arr.length] = "sector $"+oCOM.getHexByte(_s)
            // ITERATE THROUGH SECTORS
            var s = "";
            for(var _offset=0;_offset<SECTOR_SIZE;_offset++)
            {
                var idx = _t * TRACK_SIZE + _s * SECTOR_SIZE + _offset;
                var n = bytes[idx]// ^ 255
                s += oCOM.getHexByte(n);
                if((idx%4)==3) s+= " ";
            }
            s_arr[s_arr.length] = s;
        }
    }
    return s_arr;
}

</script>

<body class="slider_main" onload="init_gui();">

  <div id="slider_title"></div>
  <div class="slider_overlay">
    <div id="topmenu">
      <ul id="minitabs">
        <li><input type="file" id="loadfile" value="Disk" onchange="oCOM.Upload('loadfile')" accept=".dsk"></li>
        <li><img src='data:image/gif;base64,R0lGODlhGAAYAPAAAF3/AAAAACH5BAEAAAAALAAAAAAYABgAAAJPhG+hiu0Y4JsnSvqsBRvXtHXVQmpM4ogN+V1T2aJcSZ9cW+c4mNOf2fOBeEHWcFZc/IjFHbIpu1FgUelLWX1SsVaPKeaRhsKubLijOhspBQA7'></li>
        <li><button class=appbut value="Dump" onclick="document.getElementById('dump').innerHTML=dumpdisk(oCOM.UploadData).join('<br>')" id="dumpbutton" title="Dump">Dump layout</button></li>
        <li><button onclick="dl()">Download .NIB</button></li>
        <li><div class=no_margins id=status></div></li>
      </ul>
    </div>
    <div id=main style="width:100%;height:100%;background: linear-gradient(180deg, rgba(220,220,220,1) 0%, rgba(251,251,251,1) 50%);">
      <img alt="" style="margin:20px;width:256px;float:left;image-rendering: pixelated;" src="../res/apple-disk-ii_256.png">
      <div id="dump" style="border:1px solid;width:600px;height:500px;overflow-x:hidden;overflow-y:auto;"></div>
    </div>
  </div>
</body>
</html>