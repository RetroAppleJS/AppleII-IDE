<html>
<head>
    <meta charset='utf-8'>
    <script type="text/javascript" src="../res/showdown.js"></script>
    <style>
      body {
          font-family:'Arial';
          font-size: 12px;
          font-weight: 400;
        }
        img {
          zoom: 0.5;
          max-width:600px;
        }

        pre {
          background-color: #F6F8FA;
          border-radius: 5px 5px 5px 5px;
        }
    </style>
</head>
<body>

<script>
  Markdown2HTML("html_txt","DEBUGGER");

  function Markdown2HTML(id,filename)
  {
    const xhttp = new XMLHttpRequest();
    xhttp.onload = function() { process(this.responseText,id,filename) }
    //xhttp.open("GET", "https://raw.githubusercontent.com/RetroAppleJS/AppleII-IDE/main/README.md");
    xhttp.open("GET", "https://raw.githubusercontent.com/RetroAppleJS/AppleII-IDE/main/docs/"+filename+".md");
    xhttp.send();
  }

  //                                                     /res/appleIIplus_bck_650.png?raw=true
  // https://github.com/RetroAppleJS/AppleII-IDE/raw/main/res/appleIIplus_bck_650.png?raw=true

  function process(txt,id,filename)
  {
    var converter = new showdown.Converter();
    converter.setFlavor("github");

    //////////////////// MAKE HTML  //////////////////
    var html = converter.makeHtml(txt);
    html = html.replace(new RegExp('/res/','g'),"https://github.com/RetroAppleJS/AppleII-IDE/raw/main/res/");
    document.getElementById("src").innerHTML   = txt;
    document.getElementById(id).innerHTML      = html;
    document.getElementById("html").innerHTML = html;

    //////////////////// MAKE MARKDOWN //////////////////
    document.getElementById("markdown").innerHTML = converter.makeMarkdown(html);
    //var html = "<p>TEST</p>";
    var js = filename+'_DOC = "'+html.replace(new RegExp('\"','g'),'\\"')
                 .replace(new RegExp('\n','g'),"\"\n+\"")+'"';

    alert(js);
    //download('DOCS.js',decodeURIComponent(js));
  }

  // decodeURIComponent

  function download(filename, text)
  {
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
  }

  
</script>

<table>
<tr>
  <td><textarea id=src style="width:600px;height:300px"></textarea></td>
  <td>>></td>
  <td><textarea id=html_txt style="width:600px;height:300px"></textarea></td>
</tr>
<tr>
  <td><div id=html style="width:600px;height:300px;overflow:scroll;border: 1px solid black;font-size: 13px;"></div></td>
  <td>>></td>
  <td><textarea id=markdown style="width:600px;height:300px"></textarea></td>
</tr>
</table>
<button onclick="download('hello.txt','This is the content of my file :)')">Download</button>

</body>
</html>
