<html>
    <html style="background-color:#B0B0B0"><head>
        <title>File to URI - Zlib compression</title>
        <meta name="description" content="">
        <meta name="author" content="Freddy Vandriessche">
        <meta charset="utf-8"> 
        <link rel="stylesheet"        href="../res/COM_MAIN.css">
        <script type="text/javascript" src="TOOLS_Header.js"></script>
        <script type="text/javascript" src="../res/pako_inflate.min.js"></script>
        <script type="text/javascript" src="../res/pako_deflate.min.js"></script>
      </head>
      

  <script defer type="text/javascript">




    var CONF_version="1.0.0";
    var CONF_builddate="20240114-190000";



    function init_gui(_o)
    { 
        document.getElementById('slider_title').outerHTML = _TITLE();
    }

    function load_file(file_obj)
    {
        var blob = window.URL.createObjectURL(file_obj)
        var oReq = new XMLHttpRequest();
        var e = file_obj.name.split(".");
        ext = "."+e[e.length-1];
        ext = ext.toLowerCase(ext);

        oReq.open('GET', blob, true);
        oReq.responseType = 'arraybuffer';
        oReq.onload = function(e)
        {
            var isPerformanceSupported = (
                window.performance &&
                window.performance.now &&
                window.performance.timing &&
                window.performance.timing.navigationStart
            );

            var timeStampInMs = (
                isPerformanceSupported ?
                window.performance.now() +
                window.performance.timing.navigationStart :
                Date.now()
            );


            var arrayBuffer = oReq.response;
            if(arrayBuffer)
            {

                var l1 = arrayBuffer.byteLength 
                var fym = new Uint8Array(arrayBuffer);
                //var dump = pako.deflate( fym);

                const deflator = new pako.Deflate( { level: 9} );
                deflator.push(fym, true);
                var dump = deflator.result

                var l2 = dump.byteLength;
                var l3 = _ArrayTobase64(dump).length;


                //alert(l1+"->"+l2+" ("+(Math.round(10000*l2/l1)/100)+"%) BASE64:"+l3+" ("+(Math.round(10000*l3/l1)/100)+"%)");

                var uri = _ArrayTobase64(dump);
                var url = "../index.html?d="+uri+"#tab2";

                var link = "<br><a target=_blank href="+url+">ASSEMBLER URI "+timeStampInMs+"</a>"
                var el = document.getElementById("output");
                el.innerHTML += link;


            }
        }
        oReq.send();
    }

    function load_b64(b64)
    {
        var arrayBuffer = _base64ToArray(b64);
        if(arrayBuffer)
        {
            var fym = new Uint8Array(arrayBuffer);
            psgdump = pako.inflate(fym);
        }
    }

    _base64ToArray = function(base64)
    {
        var binary_string = window.atob(base64);
        var len = binary_string.length;
        var bytes = new Uint8Array(len);
        for (var i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    }

    _ArrayTobase64 = function(bytes) 
    {
        return btoa(String.fromCharCode.apply(null, new Uint8Array(bytes)));
    }
  </script>


<body class="slider_main" onload="init_gui();">

<div id="slider_title"></div>
<div class="slider_overlay">
    <div id="topmenu">
    <ul id="minitabs">
        <li>
            <!--   BUTTON BAR -->
            <!--
            <table class=no_margins style='display:inline-block;border:0px solid;vertical-align:top;'>
                <tr>
                    <td style="vertical-align:top;border:1px solid;width:200px">
           
                    </td>
                </tr>
            </table>
            -->
        </li>
    </ul>
    </div>
    <div id=main style="width:100%;height:100%;background: linear-gradient(180deg, rgba(220,220,220,1) 0%, rgba(251,251,251,1) 50%);">
    <table>
    <tr>
        <td><img style="margin:20px;width:256px;float:left;image-rendering:pixelated;" src="../res/zlib_icon.png"></td>
        <td rowspan="2" valign="top">
            <br>
            <button onclick="document.getElementById('getFile').click()">Load file</button>
            <input type='file' id="getFile" style="display:none" onchange="load_file(this.files[0]);">
            <div id="output"></div>
        </td>
    </tr>
    <tr>
        <td>
            <div id="dump" style="font-size:x-small;width:296px;height:120px;float:left;overflow-x:hidden;overflow-y:auto;">
            </div>
        </td>
    </tr>
    </table>
    </div>
</div>
  
</body>


</html>
