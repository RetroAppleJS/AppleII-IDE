<html style="background-color:#B0B0B0"><head>
  <title>CAMERA CAPTURE TOOL</title>
  <meta name="description" content="">
  <meta name="author" content="Freddy Vandriessche">
  <meta charset="utf-8">
  <style>
  html {height:100%;font-family:"Arial"}
  body {background-color:#808080;height:100%;margin:0px;padding:0px}


  #my_camera{
  /*width: 256px;
  height: 192px;*/
  border: 1px solid black;
  background-position: left 30px top 20px;
  background-color:white;
  background-image: url('data:image/png;base64,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');
  background-repeat: no-repeat;
  /*background-size: 240px 180px;*/
  }
    </style>
</head>

<script type="text/javascript" src="../res/EMU_apple2video.js"></script>
<script type="text/javascript" src="../res/EMU_apple2hw.js"></script>
<script type="text/javascript" src="../res/EMU_apple2io.js"></script>
<script type="text/javascript" src="../res/HGRpalette.js"></script>
<script type="text/javascript" src="../res/HGRpattern.js"></script>

<script>
var CONF_version="";
var CONF_builddate="";  

var _D = 
{
     "cam_x":256
    ,"cam_y":192
    ,"YVERTL":"0000000000000000"+"8080808080808080"+"0000000000000000"+"8080808080808080"+"0000000000000000"+"8080808080808080"+"0000000000000000"+"8080808080808080"
              +"2828282828282828"+"A8A8A8A8A8A8A8A8"+"2828282828282828"+"A8A8A8A8A8A8A8A8"+"2828282828282828"+"A8A8A8A8A8A8A8A8"+"2828282828282828"+"A8A8A8A8A8A8A8A8"
              +"5050505050505050"+"D0D0D0D0D0D0D0D0"+"5050505050505050"+"D0D0D0D0D0D0D0D0"+"5050505050505050"+"D0D0D0D0D0D0D0D0"+"5050505050505050"+"D0D0D0D0D0D0D0D0"
    ,"YVERTH":"2024282C3034383C"+"2024282C3034383C"+"2125292D3135393D"+"2125292D3135393D"+"22262A2E32363A3E"+"22262A2E32363A3E"+"23272B2F33373B3F"+"23272B2F33373B3F"
              +"2024282C3034383C"+"2024282C3034383C"+"2125292D3135393D"+"2125292D3135393D"+"22262A2E32363A3E"+"22262A2E32363A3E"+"23272B2F33373B3F"+"23272B2F33373B3F"
              +"2024282C3034383C"+"2024282C3034383C"+"2125292D3135393D"+"2125292D3135393D"+"22262A2E32363A3E"+"22262A2E32363A3E"+"23272B2F33373B3F"+"23272B2F33373B3F"
}
var yref = new Array();
  for(var i=0;i<_D.YVERTL.length;i+=2)
    yref[i/2] = parseInt( _D.YVERTH.substring(i,i+2),16)*256
               +parseInt( _D.YVERTL.substring(i,i+2),16);

var vidContext, apple2plus;
var oPALETTE = new PALETTE();
var oPATTERN = new PATTERN();

function init_gui(_o)
{
  document.getElementById('slider_title').outerHTML = _TITLE();
  vidContext          = document.getElementById('applescreen').getContext("2d");
  apple2plus          = new Apple2Plus(vidContext);
  
  var my_camera    = document.getElementById("my_camera");
  //alert(typeof(my_camera.style.width)+" ("+Number(my_camera.style.width))+")"
  
  my_camera.style.width  = _D.cam_x+"px";
  my_camera.style.height = _D.cam_y+"px";
  my_camera.style.backgroundSize = (_D.cam_x*0.8)+"px "+(_D.cam_y*0.8)+"px"
  

  for(var i=8192;i<16384;i++)      // clear video RAM
    apple2plus.hw.write(i,0);

  // Monochrome colors (index 0 = full color)
  var monoChromes = ["","#FFFFFF","#A0FFF0","#FCE7A1"];

  // Lores color to RGB table. (* Hires)
  var loresCols = [
  ["#000000","#000000","#000000","#000000","Black"]  // *
  ,["#901740","#4D4D4D","#304D48","#4C4631","Magenta"] 
  ,["#402CA5","#5B5B5B","#395B56","#5A5239","Dark Blue"] 
  ,["#D043E5","#A8A8A8","#69A89E","#A6986A","Purple"]  // *
  ,["#006940","#383838","#233835","#383324","Dark Green"] 
  ,["#808080","#808080","#508078","#7E7451","Grey 1"] 
  ,["#2F95E5","#8E8E8E","#598E85","#8C8059","Medium Blue"]  // *
  ,["#BFABFF","#CECECE","#81CEC2","#CBBA82","Light Blue"] 
  ,["#405400","#313131","#1F312E","#312D1F","Brown"] 
  ,["#D06A1A","#717171","#47716B","#706748","Orange"]  // *
  ,["#808080","#808080","#508078","#7E7451","Grey 2"] 
  ,["#FF96BF","#C7C7C7","#7DC7BB","#C4B47D","Pink"] 
  ,["#2FBC1A","#575757","#375752","#564F37","Light Green"]  // *
  ,["#BFD35A","#A4A4A4","#67A49A","#A29568","Yellow"] 
  ,["#6FE8BF","#B2B2B2","#70B2A8","#B0A170","Aquamarine"] 
  ,["#FFFFFF","#FFFFFF","#A0FFF0","#FCE7A1","White"]  // *
  ];

  function pattern(idx,j,i)
  {
    switch(idx)
    {
      case 0: return  [0,false];                 // black 1 
      case 1: return  [4,(j%2 || !(j%8))==0];    // green 
      case 2: return  [3,(j+1)%2==0];            // purple
      case 3: return  [15,!(j%8)==0];            // white 1  
      case 4: return  [0,j%8==0];                // black 2
      case 5: return  [9,j%2==0];                // orange
      case 6: return  [2,((j+1)%2 && j%8)==0];   // blue
      case 7: return  [15,true];                 // white2 2
    }
  }


  function maskPixel(byt,bit)
  {
    return byt&8 | byt&bit;
  }

  function isCollision(rbyt,wbyt)   // check color collitions
  {
    if(rbyt|wbyt==0) return false;
  }

  function isCol(x,y)
  { return x%8==0 ? "red":"white" }
    
  function PRINTByte(by)
  {
    var sa = ("0000000"+by.toString(2)).slice(-8).split("");
    //sa = sa.reverse();
    var styl = " style='padding:5px;border:1px solid;font-family:Arial'"
    return "<table style='border-collapse: collapse;'><tr><td"+styl+">"+sa.join("</td><td"+styl+">")+"</td></tr></table>"
  }

    // draw dithering patterns 
    // apple2plus.hw.write(8192,5);  
    // apple2plus.hw.write(8194,1);  

    var palette = {
0:{"idx":0,"col":"#000000","sat":0,"cmp":["#000000"],"pat":[0b00,0,0b00,0],"cri":{}},
1:{"idx":1,"col":"#7B007B","sat":122,"cmp":["#FF00FF","#000000"],"pat":[0b10,0,0b00,0],"cri":{}},
2:{"idx":2,"col":"#3E7B3E","sat":61,"cmp":["#80FF80","#000000"],"pat":[0b01,0,0b00,0],"cri":{}},
3:{"idx":3,"col":"#7B7B7B","sat":0,"cmp":["#FFFFFF","#000000"],"pat":[0b11,0,0b00,0],"cri":{}},
5:{"idx":4,"col":"#F600F6","sat":122,"cmp":["#FF00FF"],"pat":[0b10,0,0b10,0],"cri":{}},
6:{"idx":5,"col":"#B97BB9","sat":31,"cmp":["#80FF80","#FF00FF"],"pat":[0b01,0,0b10,0],"cri":{}},
7:{"idx":6,"col":"#F67BF6","sat":49,"cmp":["#FFFFFF","#FF00FF"],"pat":[0b11,0,0b10,0],"cri":{}},
10:{"idx":7,"col":"#7BF67B","sat":61,"cmp":["#80FF80"],"pat":[0b01,0,0b01,0],"cri":{}},
11:{"idx":8,"col":"#B9F6B9","sat":24,"cmp":["#FFFFFF","#80FF80"],"pat":[0b11,0,0b01,0],"cri":{}},
15:{"idx":9,"col":"#F6F6F6","sat":0,"cmp":["#FFFFFF"],"pat":[0b11,0,0b11,0],"cri":{}},
16:{"idx":10,"col":"#000000","sat":0,"cmp":["#000000"],"pat":[0b00,128,0b00,0],"cri":{"DOUBL":0}},
17:{"idx":11,"col":"#003E7B","sat":140,"cmp":["#0080FF","#000000"],"pat":[0b10,128,0b00,0],"cri":{}},
18:{"idx":12,"col":"#7B3E00","sat":140,"cmp":["#FF8000","#000000"],"pat":[0b01,128,0b00,0],"cri":{}},
21:{"idx":13,"col":"#7B3EF6","sat":92,"cmp":["#0080FF","#FF00FF"],"pat":[0b10,128,0b10,0],"cri":{}},
22:{"idx":14,"col":"#F63E7B","sat":92,"cmp":["#FF8000","#FF00FF"],"pat":[0b01,128,0b10,0],"cri":{}},
25:{"idx":15,"col":"#3EB9B9","sat":70,"cmp":["#0080FF","#80FF80"],"pat":[0b10,128,0b01,0],"cri":{}},
26:{"idx":16,"col":"#B9B93E","sat":70,"cmp":["#FF8000","#80FF80"],"pat":[0b01,128,0b01,0],"cri":{}},
29:{"idx":17,"col":"#7BB9F6","sat":47,"cmp":["#0080FF","#FFFFFF"],"pat":[0b10,128,0b11,0],"cri":{}},
30:{"idx":18,"col":"#F6B97B","sat":47,"cmp":["#FF8000","#FFFFFF"],"pat":[0b01,128,0b11,0],"cri":{}},
32:{"idx":19,"col":"#000000","sat":0,"cmp":["#000000"],"pat":[0b00,128,0b00,128],"cri":{"DOUBL":0}},
37:{"idx":20,"col":"#007BF6","sat":141,"cmp":["#0080FF"],"pat":[0b10,128,0b10,128],"cri":{}},
42:{"idx":21,"col":"#F67B00","sat":141,"cmp":["#FF8000"],"pat":[0b01,128,0b01,128],"cri":{}}
}

    oPALETTE.dec_pal      = [];
    
    var w = 0;
    for(var i in palette)
    {
      var idx = palette[i].idx;
      oPALETTE.dec_pal[idx] = oPALETTE.HEX2RGB(palette[i].col);
      if(palette[i].pat[0]>w) w=palette[i].pat[0];

      //console.log("dec_pal["+idx+"] = oPALETTE.HEX2RGB("+palette[i].col+") " +oPALETTE.HEX2RGB(palette[i].col).join(" ")+" ("+i+")")
    }
    
    var w = Math.floor(Math.log(w+1)/Math.log(2));
    var h = palette[0].pat.length/2;
    console.log("w="+w+" h="+h);

    var input = [13,23,29]
    var result = oPALETTE.calc_nearest_IDX_ERR(input)
    console.log("input="+input+" idx="+result[0]+" error="+result[1]+" --> ["+oPALETTE.dec_pal[result[0]]+"]");
}











function Apple2Plus(context)
{
  this.video = new Apple2Video(context);
  this.hw    = new Apple2Hw(this.video);
  // Switch on Apple II Hi-Res graphics
  this.video.reset();
  this.video.setGfx(true);
  this.video.setHires(true);
  this.video.redraw();
}

// Overloading the setPixel function to accomodate patterning
function setPixel_HGR(x,y,patternID)
{
    // find address and bit location
    var adr = yref[y] + Math.floor(x/7);              // find address 
    var wbyt = apple2plus.hw.read(adr) | 1 << x%7;    // OR current bit with pixel bit
    apple2plus.hw.write(adr,wbyt);                    // write byte 
}

function wipe_HGR(byte)
{
    // find address and bit location
    //var adr = yref[y] + Math.floor(x/7);              // find address 
    //var wbyt = apple2plus.hw.read(adr) | 1 << x%7;    // OR current bit with pixel bit
    for(var adr=8192;adr<16384;adr++)
      apple2plus.hw.write(adr,byte);                    // write byte 
}





/////////////////////////////////////////////////////////

var _T = function _T(idx,mod) {
this.t = {get _language(){ return "NL" }
,"title":document.title
,"menu_convert":""
,"menu_info":"Info/Contact"
,"intro":""
,"version":(CONF_version?("Version "+CONF_version):"")
,"built":(CONF_builddate?("Built "+CONF_builddate):"")
,get _(){return this}
}
if(idx.length>0 && typeof(this.t[idx])=="undefined") { alert(idx); return "<font color=red>"+idx+"</font>" }
switch(mod) {
  case "cap": return this.t[idx].charAt(0).toUpperCase()+this.t[idx].substring(1,this.t[idx].length);
  case "inv": { var j = {}; for(var i in t) { j[ t[i] ] = i }; return j } // inverse associative
  default: return this.t[idx];
}
}
function _D(idx) { if(typeof(_T(idx)=="string")) document.write(_T(idx)) }
function _TITLE() {
var css = "#texturespace {background: #f7f7f7 url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAEEAYAAAD5YUI9AAAACXBIWXMAAA4mAAAOJgGi7yX8AAAARElEQVQIHWPYyrxTed9eg3UQWkQHQgtaQGg5JgaohAdUoglC8z+A0mFQBYIpUIEXULoOQgvIQRXIBUElMqASShBaWQwApNg4NPAzQGwAAAAASUVORK5CYII=') repeat center top;font: 62.5%/1 sans-serif;height: 100%;width: 100%;}"
+"#carvetext {color: transparent;background: #f7f7f7;font: 62.5%/1 sans-serif;stroke: 2px rgba(0,0,0,0.2);background-color: rgba(140,140,140,1);-webkit-background-clip: text;text-shadow: rgba(255,255,255,0.5) 0 5px 6px, rgba(255,255,255,0.2) 1px 3px 3px;transition: text-shadow .1s ease-out, background-color .2s ease-out;}"
+"#carvetext:hover {color: transparent;background-color: rgba(82,96,117,0.5);-webkit-background-clip: text;text-shadow: rgba(255,255,255,0.5) 0 5px 6px;}"
+"#carvetext:focus {outline: none;}.slider_main {position: relative;height: 100%;}"
+".slider_overlay {position: absolute;bottom: 0;left: 0;right: 0;background-color: #A0A0A0;overflow: hidden;width: 100%;height: 85%;transition: .5s ease;}"
//+".slider_main:hover "
+".slider_overlay {height: 100%;}"
+"#topmenu{width:100%;background-color:#f0f0f0}"
+"ul#minitabs{list-style:none;margin:0;padding:3px 0 0 0;border-left:1px solid #ccc;border-right:1px solid #ccc;border-top:1px solid #ccc;border-bottom:1px solid #ccc;font-weight:700;text-align:left;white-space:nowrap}ul#minitabs li{display:inline;margin:0 3px}ul#minitabs a{text-decoration:none;color:#999}ul#minitabs a#current{border-color:#f60;color:#06f}ul#minitabs a:hover{border-color:#f60;color:#666}"

return "<style>"+css+".slider_overlay{height: 85%}</style>"
+"<div id=texturespace style='height:100%;width:100%'><center><div id='carvetext'>"
+"<div style='font-size:5em'>"+(typeof(_T("title"))=="string"?_T("title"):"")+"</div>"
+"<div style='font-size:1em'>"+(typeof(_T("version"))=="string"?_T("version"):"")
+" &nbsp; "+(typeof(_T("built"))=="string"?_T("built"):"")+"</div>"
+"</div></center></div>"
}


</script>

 <body class="slider_main" onload=init_gui()>

<div id="slider_title"></div>
 <div class="slider_overlay">
    <div id="topmenu">
      <ul id="minitabs">
        <li><input type=button value="Enable camera" onclick="enable_camera()"></li>
        <li><img src='data:image/gif;base64,R0lGODlhGAAYAPAAAF3/AAAAACH5BAEAAAAALAAAAAAYABgAAAJPhG+hiu0Y4JsnSvqsBRvXtHXVQmpM4ogN+V1T2aJcSZ9cW+c4mNOf2fOBeEHWcFZc/IjFHbIpu1FgUelLWX1SsVaPKeaRhsKubLijOhspBQA7'></li>
        <li><input type=button value="Take Snapshot" onclick="take_snapshot()"></li>
      </ul>
    </div>
    <div id=main>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.24/webcam.js"></script>

<!-- -->
<table><tr>
  <td style=vertical-align:top;><div id="my_camera"></div><div id="results"></div>
    <div id=debug style="overflow:scroll; height:400px;"></div></td>
  <td style=vertical-align:top;><canvas class="appvid" id="applescreen" width="560" height="384"></canvas></td>
</tr></table>

<!-- Code to handle taking the snapshot and displaying it locally -->
<script language="JavaScript">

// Configure a few settings and attach camera
var bCamera = false;
var shutter = new Audio();

function enable_camera()
{
  if(!bCamera)
  {
    Webcam.set({
    width:  _D.cam_x,
    height: _D.cam_y,
    image_format: 'jpeg',
    jpeg_quality: 90
    });
    Webcam.attach('#my_camera');

    // preload shutter audio clip
    shutter.autoplay = true;
    shutter.src = navigator.userAgent.match(/Firefox/) ? 'shutter.ogg' : 'shutter.mp3';
  }
  else Webcam.reset();

  bCamera = !bCamera;
}

function take_snapshot()
{
  // play sound effect
  shutter.play();
  // take snapshot and get image data
  Webcam.snap( function(data_uri) {
  // display results in page
  document.getElementById('results').innerHTML = '<img onload=process_snapshot() id=snap class=snap src="'+data_uri+'"/>';
  } );
}

function process_snapshot()
{
        wipe_HGR(0);

        var el = document.getElementById("snap");

        // Take image size
        var h = el.clientHeight;
        var w = el.clientWidth;

        var ctx = getContext(el);
        // Put the picture in
        ctx.drawImage(el,0,0,w,h);
        // Pick image data
        var in_image = ctx.getImageData(0,0,w,h);
        var d = new Uint8ClampedArray(in_image.data);
        //var out_imgdata = ctx.createImageData(in_image);
        //var out = new Uint8ClampedArray(in_image.data);
        //var $i = function(x,y) { return (4*x) + (4*y*w); };

        function pixelDecision(c)
        {
          return c[0]+c[1]+c[2] > 240
        }
        
        for (var y=0;y<h;y++)
        {
            for (var x=0;x<w;x+=2)
            {
                var i = (4*x) + (4*y*w);
                var color = [ d[i],d[i+1],d[i+2] ];
                if(pixelDecision(color)) setPixel_HGR(x,y);

                var i = (4*x) + (4*y*w);
                var color = [ d[i],d[i+1],d[i+2] ];
                if(pixelDecision(color)) setPixel_HGR(x+1,y);              
            }
        }
        

        /*
        for (var y=0;y<h;y++)
        {
            for (var x=0;x<w;x+=7)
            {
                var i = (4*x) + (4*y*w);
                var color_arr = [
                     [d[i]   ,d[i+1] ,d[i+2] ]
                    ,[d[i+4] ,d[i+5] ,d[i+6] ]
                    ,[d[i+8] ,d[i+9] ,d[i+10]]
                    ,[d[i+12],d[i+13],d[i+14]]
                    ,[d[i+16],d[i+17],d[i+18]]
                    ,[d[i+20],d[i+21],d[i+22]]
                    ,[d[i+23],d[i+24],d[i+25]]
                    ,[d[i+27],d[i+28],d[i+29]]
                  ]; 

                if(((color[0]+color[1]+color[2])/3) > 80)
                  setPixel_HGR(x,y)
              }
        }
        */
        
        function color_byte(x,y,color_arr)
        {

        }


}


        /**
        * borrowed from ditherjs.js  !!!!
        * */
        function getContext(el) {
            var canvas = document.createElement('canvas');
            // this can influence the quality of the acquistion
            canvas.height = el.clientHeight;
            canvas.width = el.clientWidth;
            el.parentNode.replaceChild(canvas,el);

            // Inherit classes
            canvas.className = el.className;
            canvas.className = canvas.className.replace('snap',' ');
            // Inherit Styles

            // Turn it off
            // canvas.style.visibility = "hidden";

            // Get the context
            var ctx = canvas.getContext('2d');
            ctx.imageSmoothingEnabled = false;
            return ctx;    
        }

</script>


  </div>
  </div>

  <script>
     document.write( oPATTERN.trace_diffusion_data() );
  </script>
</body>
</html>