<!--
  https://googlechromelabs.github.io/web-audio-samples/audio-worklet/
  https://atornblad.se/generating-sound-in-modern-web-audio-api
-->

<!doctype html>
<html>

<body>
<a href="https://atornblad.se/generating-sound-in-modern-web-audio-api">article</a>
<button id="button-start" onclick="beep()">BEEP</button>

<script>
  // Create the audio context
  const audio = new AudioContext();
  var player;

  // A simple onLoad handler. It also handles user gesture to unlock the audio playback.
  window.addEventListener('load', async () =>
  {
    audio.suspend();
    await audio.audioWorklet.addModule('player-worklet.js');  // Load an audio worklet
    player = new AudioWorkletNode(audio,'player-worklet');    // Create a player
    player.connect(audio.destination);                        // Connect the player to the audio context
  });

  function beep()
  {
    if(audio.state == "running") audio.suspend();
    if(audio.state == "suspended")  audio.resume();
    player.port.postMessage({ type:'play' });
    player.port.onmessage = (e) => console.log(e.data); // log messages from within the worklet
  }
</script>
</body>
</html>